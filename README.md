# Colorectal_Histology_MNIST
Classification of colorectal cancer histology into 8 classes

Datasets obtained from https://www.kaggle.com/kmader/colorectal-histology-mnist

Original source: https://www.nature.com/articles/srep27988
# Project Aim:
### Multiclass classification of histological H&E images of of human colorectal cancer into 8 classes of tissue types:
  * `TUMOR` -- Tumour epithelium
  
  * `STROMA` -- Simple stroma (homogeneous composition, includes tumour stroma, extra-tumoural stroma and smooth muscle)
  
  * `COMPLEX` -- Complex stroma (containing single tumour cells and/or few immune cells)
  
  * `LYMPHO` -- Immune cells (including immune-cell conglomerates and sub-mucosal lymphoid follicles)
  
  * `DEBRIS` -- Debris (including necrosis, hemorrhage and mucus)
  
  * `MUCOSA` -- Normal mucosal glands
  
  * `ADIPOSE` -- Adipose tissue
  
  * `EMPTY` -- Background (no tissue)
  
  The dataset contains 5000 images with 625 images for each class. All the images are 150x150px in RGB mode.
  
  Here is a panel of representative images from each class:
  
  ![image1_histology](https://github.com/xiey1/Colorectal_Histology_MNIST/blob/master/images/Histology_8classes.png)

# Approach -- Convolutional Neural Network:
Images are stratified into training, validation and test datasets with a split ratio of 0.7/0.15/0.15.
Training dataset is used to train the CNN model;
Validation dataset is used to assess and record the prediction performance during training process to avoid overfitting and help choose the model with the best performance;
Test dataset is used to evaluate the model and compare the prediction performance among different models

Here I tried both CNN model built from scratch and transfer learning to study this multiclass classification problem

### 14-layer CNN model built from scratch
**((ConV-ReLU)x3-MaxPool)x3 --flattening-- FC1-ReLU-FC2**

![CNN_scratch](https://github.com/xiey1/Colorectal_Histology_MNIST/blob/master/images/Image1_CNN.png)

### Transfer Learning with Inception_v3
1. `Inception_fc1`: Freeze all the convolutional layers before the final classifer and train the classifier
2. `Inception_fc2`: Freeze all the convolutional layers, add a fully-connected layer with 256 nodes before the final classifier and train both the fully-connected layer as well as the final classifier

# Result:
Pretrained Inception_v3 model with trained fully-connected layer and classifier achieves the best performance with on overall prediction accuracy of 89.867%. 
  ![Accuracy_summary](https://github.com/xiey1/Colorectal_Histology_MNIST/blob/master/images/Accuracy_summary.png)

# Model Evaluation:
Here I mainly focused on the evaluation performance of the optimal Inception_v3 model with trained additional fully-connected layer and classifier (Inception_fc2)


<img src='https://github.com/xiey1/Colorectal_Histology_MNIST/blob/master/images/Accuracy_inception_fc2.png' width=600px>

<img src='https://github.com/xiey1/Colorectal_Histology_MNIST/blob/master/images/Confusion_matrix.png' width=500px>

![roc_curve](https://github.com/xiey1/Colorectal_Histology_MNIST/blob/master/images/ROC_curve.png)

In addition, t-SNE plots can give us a clear visualization of how good each class is separated after being propagated through the trained CNN model. Here, t-SNE plots are generated by both raw pixels from each image and features extracted by the trained `Inception_fc2` model for each image as shown below:

![tSNE_raw_pixel](https://github.com/xiey1/Colorectal_Histology_MNIST/blob/master/images/t-SNE_raw_pixels.png)

![tSNE_Inception_fc2](https://github.com/xiey1/Colorectal_Histology_MNIST/blob/master/images/t-SNE_feature_extraction.png)

# Application:
Here, I used the trained Inception_fc2 model to predict tissue types of specific regions from a larger 5000x5000px H&E image of colorectal cancer. 

![Application_image1_raw](https://github.com/xiey1/Colorectal_Histology_MNIST/blob/master/images/Application_1_raw.png)

![Application_image1_pred](https://github.com/xiey1/Colorectal_Histology_MNIST/blob/master/images/Application_1_pred.png)
