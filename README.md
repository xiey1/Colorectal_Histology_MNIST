# Colorectal_Histology_MNIST
Classification of colorectal cancer histology into 8 classes

Datasets obtained from https://www.kaggle.com/kmader/colorectal-histology-mnist

Original source: https://www.nature.com/articles/srep27988

# Project Aim:
### Multiclass classification of histological H&E images of of human colorectal cancer into 8 classes of tissue types:
  * `TUMOR` -- Tumour epithelium
  
  * `STROMA` -- Simple stroma (homogeneous composition, includes tumour stroma, extra-tumoural stroma and smooth muscle)
  
  * `COMPLEX` -- Complex stroma (containing single tumour cells and/or few immune cells)
  
  * `LYMPHO` -- Immune cells (including immune-cell conglomerates and sub-mucosal lymphoid follicles)
  
  * `DEBRIS` -- Debris (including necrosis, hemorrhage and mucus)
  
  * `MUCOSA` -- Normal mucosal glands
  
  * `ADIPOSE` -- Adipose tissue
  
  * `EMPTY` -- Background (no tissue)
  
  The dataset contains 5000 images with 625 images for each class. All the images are 150x150px in RGB mode.
  
  Here is a panel of representative images from each class:
  
  <img src='https://github.com/xiey1/Colorectal_Histology_MNIST/blob/master/images/Histology_8classes.png' width=600px>

# Approach -- Convolutional Neural Network:
Images are stratified into training, validation and test datasets with a split ratio of 0.7/0.15/0.15.
Training dataset is used to train the CNN model;
Validation dataset is used to assess and record the prediction performance during training process to avoid overfitting and help choose the model with the best performance;
Test dataset is used to evaluate the model and compare the prediction performance among different models

Here I tried both CNN model built from scratch and transfer learning to study this multiclass classification problem

### 14-layer CNN model built from scratch
**((ConV-ReLU)x3-MaxPool)x3 --flattening-- FC1-ReLU-FC2**

<img src='https://github.com/xiey1/Colorectal_Histology_MNIST/blob/master/images/Image1_CNN.png' width=900px>

### Transfer Learning with Inception_v3
1. `Inception_v3`: Freeze all the convolutional layers before the final classifer and train the classifier
2. `Inception_v3_fc2`: Freeze all the convolutional layers, add a fully-connected layer with 256 nodes before the final classifier and train both the fully-connected layer as well as the final classifier

# Result:
Pretrained Inception_v3 model with trained fully-connected layer and classifier achieves the best performance with on overall prediction accuracy of 89.867%. 

<img src='https://github.com/xiey1/Colorectal_Histology_MNIST/blob/master/images/Accuracy_summary.png' width=600px>

# Model Evaluation:

Here I mainly focused on the evaluation performance of the optimal Inception_v3 model with trained additional fully-connected layer and classifier (Inception_v3_fc2)


<img src='https://github.com/xiey1/Colorectal_Histology_MNIST/blob/master/images/Accuracy_inception_v3_fc2.png' width=500px>

<img src='https://github.com/xiey1/Colorectal_Histology_MNIST/blob/master/images/Confusion_matrix.png' width=500px>

<img src='https://github.com/xiey1/Colorectal_Histology_MNIST/blob/master/images/ROC_curve.png' width=500px>

In addition, t-SNE plots can give us a clear visualization of how good each class is separated after being propagated through the trained CNN model. Here, t-SNE plots are generated by both raw pixels from each image and features extracted by the trained `Inception_v3_fc2` model for each image as shown below:

<img src='https://github.com/xiey1/Colorectal_Histology_MNIST/blob/master/images/tSNE_plot.png' width=900px>

# Application:
### 1. Predict tissue type in region of interest
Here, I used the trained Inception_v3_fc2 model to predict tissue types of the specified regions of interest from a set of independent larger 5000x5000px H&E images of colorectal cancer. 

<img src='https://github.com/xiey1/Colorectal_Histology_MNIST/blob/master/images/Application_1_raw.png' width=300px>

<img src='https://github.com/xiey1/Colorectal_Histology_MNIST/blob/master/images/Application_1_pred.png' width=900px>


### 2. Tissue segmentation and multi-channel visualization
Here, I applied the trained CNN model to segment tissue types on whole-slide pathology images and presented the classification result with multi-channel visualization.

<img src='https://github.com/xiey1/Colorectal_Histology_MNIST/blob/master/images/img1_pred.png' width=600px>

<img src='https://github.com/xiey1/Colorectal_Histology_MNIST/blob/master/images/img2_pred.png' width=600px>

<img src='https://github.com/xiey1/Colorectal_Histology_MNIST/blob/master/images/img3_pred.png' width=600px>

In addition, for each tissue type, we can plot the prediction confidence or class probabilities.

<img src='https://github.com/xiey1/Colorectal_Histology_MNIST/blob/master/images/img1_prob_TUMOR.png' width=600px>

<img src='https://github.com/xiey1/Colorectal_Histology_MNIST/blob/master/images/img2_prob_TUMOR.png' width=600px>
